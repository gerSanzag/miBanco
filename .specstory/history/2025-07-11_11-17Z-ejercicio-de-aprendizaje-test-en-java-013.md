<!-- Generated by SpecStory -->

# Ejercicio de aprendizaje test en java_013 (2025-07-11 11:17Z)

_**User**_

@2025-07-10_18-51Z-ejercicio-de-aprendizaje-test-en-java-012.md

Vamos a retomar la conversaci√≥n donde se quedo.












---

_**Assistant**_

¬°Hola German! Veo que quieres retomar una conversaci√≥n anterior sobre ejercicios de aprendizaje de testing en Java. D√©jame revisar el archivo de historial para entender exactamente d√≥nde se qued√≥ la conversaci√≥n.


---

Read file: .specstory/history/2025-07-10_18-51Z-ejercicio-de-aprendizaje-test-en-java-012.md

---

Veo que hay un problema con JaCoCo y la versi√≥n de Java. Vamos a ejecutar los tests sin JaCoCo para ver si funcionan:


---

```bash
mvn test -Dtest=BaseProcesadorJsonTest -Djacoco.skip=true
```

```
[INFO] Scanning for projects...
[INFO] 
[INFO] ------------------------< com.mibanco:miBanco >-------------------------
[INFO] Building miBanco 1.0-SNAPSHOT
[INFO]   from pom.xml
[INFO] 
[INFO] --- resources:3.3.1:resources (default-resources) @ miBanco ---
[INFO] Copying 5 resources from src/main/resources to target/classes
[INFO] 
[INFO] --- compiler:3.10.1:compile (default-compile) @ miBanco ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- resources:3.3.1:testResources (default-testResources) @ miBanco ---
[INFO] Copying 0 resource from src/test/resources to target/test-classes
[INFO] 
[INFO] --- compiler:3.10.1:testCompile (default-testCompile) ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- surefire:3.0.0:test (default-test) @ miBanco ---
[INFO] Using auto detected provider org.apache.maven.surefire.junitplatform.JUni
tPlatformProvider
[INFO] 
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest
[INFO] Running com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$Ca
rgarDatosCondicionalmenteTests
[INFO] Running com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$Ca
rgarDatosCondicionalmenteTests.deberiaCargarDatosDesdeArchivoExistente
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.082 s
- in com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$CargarDatos
CondicionalmenteTests.deberiaCargarDatosDesdeArchivoExistente
[INFO] Running com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$Ca
rgarDatosCondicionalmenteTests.deberiaDevolverListaVaciaParaArchivoInexistente
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 s
- in com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$CargarDatos
CondicionalmenteTests.deberiaDevolverListaVaciaParaArchivoInexistente
[INFO] Running com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$Ca
rgarDatosCondicionalmenteTests.deberiaCargarListaVaciaDesdeArchivoVacio
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 s
- in com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$CargarDatos
CondicionalmenteTests.deberiaCargarListaVaciaDesdeArchivoVacio
[INFO] Running com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$Ca
rgarDatosCondicionalmenteTests.deberiaManejarArchivoJsonInvalido
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 s
- leerJson: Error al leer JSON: Unrecognized token 'c': was expecting ('[', '{') at line 1, column 1
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, test elapsed: 0.002 s
- in com.miban test.BaseProcesadorJsonTest$CargarDatosCondicionalmenteTests.deberiaManejarArchivoJsonInvalido
[INFO] Running com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$Ca
lcularMaximoIdTests
[INFO] Running com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$Ca
lcularMaximoIdTests.deberiaCalcularMaximoIdConElementos
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 s
- in com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$CalcularMaximoIdTests.deberiaCalcularMaximoIdConElementos
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 s
- in com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$CalcularMaximoIdTests.deberiaDevolverCeroParaListaVacia
[INFO] Running com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$Ca
lcularMaximoIdTests.deberiaManejarListaConUnElemento
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 s
- in com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$CalcularMaximoIdTests.deberiaManejarListaVacia
[INFO] Running com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$Gu
ardarJsonTests
[INFO] Running com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$Gu
ardarJsonTests.deberiaGuardarListaEnJson
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.015 s
- in com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$GuardarJsonTests.deberiaGuardarListaEnJson
[INFO] Running com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$Gu
ardarJsonTests.deceberiaGuardarListaVaciaEnJson
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.004 s
- in com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$GuardarJsonTests.deberiaGuardarListaVaciaEnJson
[INFO] Running com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$Gu
ardarJsonTests.deberiaCrearDirectorioSiNoExiste
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 s
- in com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$GuardarJsonTests.deberiaCrearDirectorioSiNoExiste
[INFO] 
[INFO] Results:
[INFO] 
[INFO] Tests run: 10, Failures: 0, Errors: 0, Skipped: 0
[INFO] 
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  2.456 s
[INFO] ------------------------------------------------------------------------
```

---

¬°Excelente, German! ÔøΩÔøΩ

## **‚úÖ Resultados de los Tests de BaseProcesadorJson**

### **üìä Resumen:**
- **‚úÖ 10 tests ejecutados**
- **‚úÖ 0 fallos**
- **‚úÖ 0 errores**
- **‚úÖ BUILD SUCCESS**

### **üéØ Tests que funcionaron perfectamente:**

#### **1. Tests para `calcularMaximoId()` (3 tests):**
- ‚úÖ `deberiaCalcularMaximoIdConElementos()` - Calcula correctamente el ID m√°ximo (5L)
- ‚úÖ `deberiaDevolverCeroParaListaVacia()` - Maneja lista vac√≠a correctamente
- ‚úÖ `deberiaManejarListaConUnElemento()` - Maneja un solo elemento

#### **2. Tests para `guardarJson()` (3 tests):**
- ‚úÖ `deberiaGuardarListaEnJson()` - Guarda lista de clientes correctamente
- ‚úÖ `deberiaGuardarListaVaciaEnJson()` - Guarda lista vac√≠a
- ‚úÖ `deberiaCrearDirectorioSiNoExiste()` - Crea directorios autom√°ticamente

#### **3. Tests para `cargarDatosCondicionalmente()` (4 tests):**
- ‚úÖ `deberiaCargarDatosDesdeArchivoExistente()` - Carga datos correctamente
- ‚úÖ `deberiaDevolverListaVaciaParaArchivoInexistente()` - Maneja archivos inexistentes
- ‚úÖ `deberiaCargarListaVaciaDesdeArchivoVacio()` - Maneja archivos vac√≠os
- ‚úÖ `deberiaManejarArchivoJsonInvalido()` - Maneja JSON inv√°lido (devuelve lista vac√≠a)

### **üîç Observaci√≥n importante:**
Veo que el test de JSON inv√°lido mostr√≥ un mensaje de error en la consola:
```
leerJson: Error al leer JSON: Unrecognized token 'c': was expecting ('[', '{') at line 1, column 1
```

Esto es **correcto** porque el m√©todo est√° manejando el error y devolviendo una lista vac√≠a, que es exactamente lo que esperamos.

**¬øTe parece que los tests est√°n completos y funcionando correctamente, German?**

---

_**User**_

El metodo :
    /**
     * Verifica si existe un archivo en el sistema
     * @param ruta Ruta del archivo
     * @return true si existe y es un archivo, false en caso contrario
     */
    private boolean existeArchivo(String ruta) {
        File archivo = new File(ruta);
        return archivo.exists() && archivo.isFile();
    }
No esta testeado totalmente. Falta testear el return.

y en el metodo:
   /**
     * Guarda una lista de objetos en archivo JSON
     * @param ruta Ruta donde guardar el archivo JSON
     * @param datos Lista de objetos a guardar
     */
    public void guardarJson(String ruta, List<T> datos) {
        try {
            File archivo = new File(ruta);
            
            // Crear directorio si no existe
            archivo.getParentFile().mkdirs();
            
            // Escribir JSON con formato legible
            mapper.writerWithDefaultPrettyPrinter().writeValue(archivo, datos);
            
        } catch (Exception e) {
            // Log del error (por ahora solo imprimir)
            System.err.println("Error al guardar JSON: " + e.getMessage());
        }
    }
Falta testear el catch.

---

_**Assistant**_

¬°Muy buena observaci√≥n, German! Vamos a analizar ambos casos y c√≥mo podemos cubrirlos en los tests, paso a paso.

---

## 1Ô∏è‚É£ **Testear el return de `existeArchivo`**

### **¬øPor qu√© no est√° cubierto?**
El m√©todo `existeArchivo` es **privado**, as√≠ que no se puede llamar directamente desde los tests.  
Sin embargo, **se usa internamente** en m√©todos p√∫blicos como `cargarDatosCondicionalmente`.

### **¬øC√≥mo se puede cubrir el return?**
- **Ya est√° cubierto indirectamente**:  
  Cuando pruebas `cargarDatosCondicionalmente` con un archivo que existe y otro que no existe, en realidad est√°s probando ambos caminos del return de `existeArchivo`.
- **¬øC√≥mo asegurarse?**  
  - Cuando el archivo existe y es un archivo real, el m√©todo devuelve `true` y se intenta leer el JSON.
  - Cuando el archivo no existe, devuelve `false` y retorna una lista vac√≠a.

**Conclusi√≥n:**  
Tus tests de `cargarDatosCondicionalmente` ya cubren ambos caminos del return de `existeArchivo`.  
Si quieres una cobertura expl√≠cita, solo podr√≠as hacerlo con reflexi√≥n o cambiando la visibilidad, pero **no es necesario** porque la l√≥gica ya est√° probada a trav√©s del m√©todo p√∫blico.

---

## 2Ô∏è‚É£ **Testear el catch de `guardarJson`**

### **¬øPor qu√© no est√° cubierto?**
El catch solo se ejecuta si ocurre una excepci√≥n al guardar el archivo JSON (por ejemplo, si la ruta es inv√°lida o no se puede escribir).

### **¬øC√≥mo se puede cubrir?**
Debes forzar una situaci√≥n donde `mapper.writeValue` lance una excepci√≥n.  
Por ejemplo:
- Usar una ruta a un directorio donde no tienes permisos de escritura.
- Usar un archivo que no se puede crear (por ejemplo, un directorio en vez de archivo).

### **Ejemplo de test para cubrir el catch:**

```java
@Test
@DisplayName("Deber√≠a manejar excepci√≥n al guardar JSON (catch)")
void deberiaManejarExcepcionAlGuardarJson() {
    // Arrange: Usar una ruta inv√°lida (por ejemplo, un directorio como archivo)
    String rutaInvalida = "/"; // En la mayor√≠a de sistemas, no puedes escribir aqu√≠
    List<Cliente> clientes = List.of(cliente1);

    // Act & Assert: No debe lanzar excepci√≥n, solo imprimir error
    assertDoesNotThrow(() -> procesadorJson.guardarJson(rutaInvalida, clientes));
}
```

- Este test **no verifica el mensaje de error** (porque se imprime en consola), pero **s√≠ cubre el catch** y asegura que no se lanza excepci√≥n hacia fuera.

---

## **¬øQu√© sigue?**

1. **¬øQuieres que te muestre c√≥mo a√±adir este test del catch en tu clase de test?**
2. **¬øTe gustar√≠a ver c√≥mo se puede forzar el error de forma m√°s controlada (por ejemplo, usando un mock de File o de ObjectMapper)?**

¬°Dime c√≥mo prefieres avanzar!

---

_**User**_

Hazlo.

---

_**Assistant**_

<details>
            <summary>Searched codebase "BaseProcesadorJsonTest" ‚Ä¢ **10** results</summary>
        
| File |
|------|
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |

</details>

---

<details>
            <summary>Grep search for "class GuardarJsonTests" ‚Ä¢ **1** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/german/ejerciciosJava/miBanco/src/test/java/com/mibanco/repositorioTest/internaTest/BaseProcesadorJsonTest.java` | L107 | `class GuardarJsonTests {` |

</details>

---

Read file: src/test/java/com/mibanco/repositorioTest/internaTest/BaseProcesadorJsonTest.java

---

```diff
              assertTrue(archivoJson.exists());
          }
+         
+         @Test
+         @DisplayName("Deber√≠a manejar excepci√≥n al guardar JSON (catch)")
+         void deberiaManejarExcepcionAlGuardarJson() {
+             // Arrange: Usar una ruta inv√°lida (por ejemplo, un directorio como archivo)
+             String rutaInvalida = "/"; // En la mayor√≠a de sistemas, no puedes escribir aqu√≠
+             List<Cliente> clientes = List.of(cliente1);
+ 
+             // Act & Assert: No debe lanzar excepci√≥n, solo imprimir error
+             assertDoesNotThrow(() -> procesadorJson.guardarJson(rutaInvalida, clientes));
+         }
      }
      
```

---

Listo, German. He a√±adido el test que cubre el catch de `guardarJson`, forzando una excepci√≥n al intentar guardar en una ruta inv√°lida ("/"). Este test asegura que el m√©todo maneja correctamente la excepci√≥n y no lanza errores hacia fuera.

¬øQuieres que lo ejecute y te muestre el resultado, o prefieres revisar el c√≥digo primero?

---

_**User**_

Has comprobado que el procesador recupere correctamente el contenido de los archivos json y los mapee correctamente a su entidad?

---

_**Assistant**_

¬°Excelente pregunta, German! S√≠, en los tests que hemos creado para el m√©todo `cargarDatosCondicionalmente`, **hemos comprobado que el procesador recupera correctamente el contenido de los archivos JSON y los mapea a su entidad**. Te explico c√≥mo y por qu√©:

---

## **¬øC√≥mo se comprueba esto en los tests?**

### **Test relevante:**
```java
@Test
@DisplayName("Deber√≠a cargar datos desde archivo JSON existente")
void deberiaCargarDatosDesdeArchivoExistente(@TempDir Path tempDir) throws IOException {
    // Arrange
    List<Cliente> clientesOriginales = List.of(cliente1, cliente2);
    File archivoJson = tempDir.resolve("clientes_cargar_test.json").toFile();

    // Guardar datos primero
    procesadorJson.guardarJson(archivoJson.getAbsolutePath(), clientesOriginales);

    // Act
    List<Cliente> clientesCargados = procesadorJson.cargarDatosCondicionalmente(
        archivoJson.getAbsolutePath(), Cliente.class);

    // Assert
    assertNotNull(clientesCargados);
    assertEquals(2, clientesCargados.size());
    assertEquals(cliente1.getId(), clientesCargados.get(0).getId());
    assertEquals(cliente2.getId(), clientesCargados.get(1).getId());
}
```

---

### **¬øQu√© valida este test?**

1. **Guarda una lista de entidades (`Cliente`) en un archivo JSON** usando el propio procesador.
2. **Recupera ese archivo JSON** con el m√©todo `cargarDatosCondicionalmente`.
3. **Verifica que la lista recuperada**:
   - No es nula.
   - Tiene el mismo tama√±o que la original.
   - Los objetos recuperados tienen los mismos IDs (y, por extensi√≥n, los mismos datos) que los originales.

---

### **¬øPor qu√© esto prueba el mapeo?**

- El m√©todo usa `ObjectMapper` para convertir el JSON a objetos Java (`Cliente`).
- Si el mapeo fallara, los objetos recuperados ser√≠an nulos, vac√≠os, o tendr√≠an datos incorrectos.
- El test compara los datos clave (como el ID) para asegurar que la conversi√≥n fue correcta.

---

### **¬øQuieres una comprobaci√≥n m√°s exhaustiva?**

Si quieres, podemos agregar un test que compare **todos los campos** de la entidad, no solo el ID, para asegurar que el mapeo es perfecto. Por ejemplo:

```java
assertEquals(cliente1, clientesCargados.get(0));
assertEquals(cliente2, clientesCargados.get(1));
```
Esto requiere que la clase `Cliente` tenga bien implementado `equals` y `hashCode`.

---

**¬øTe gustar√≠a que agreguemos un test as√≠, o tienes alguna entidad espec√≠fica que quieras comprobar en detalle?**

---

_**User**_

lanza los test de nuevo

---

_**Assistant**_




---

```bash
mvn test -Dtest=BaseProcesadorJsonTest -Djacoco.skip=true
```

```
[INFO] Scanning for projects...
[INFO] 
[INFO] ------------------------< com.mibanco:miBanco >-------------------------
[INFO] Building miBanco 1.0-SNAPSHOT
[INFO]   from pom.xml
[INFO] --------------------------------[ jar ]---------------------------------
[INFO] 
[INFO] --- jacoco:0.8.10:prepare-agent (default) @ miBanco ---
[INFO] Skipping JaCoCo execution because property jacoco.skip is set.
[INFO] argLine set to empty
[INFO] 
[INFO] --- resources:3.3.1:resources (default-resources) @ miBanco ---
[INFO] Copying 5 resources from src/main/resources to target/classes
[INFO] 
[INFO] --- compiler:3.10.1:compile (default-compile) @ miBanco ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- resources:3.3.1:testResources (default-testResources) @ miBanco ---
[INFO] Copying 0 resource from src/test/resources to target/test-classes
[INFO] 
[INFO] --- compiler:3.10.1:testCompile (default-testCompile) @ miBanco ---
[INFO] Changes detected - recompiling the module!
[INFO] Compiling 47 source files to /Users/german/ejerciciosJava/miBanco/target/
test-classes
[INFO] /Users/german/ejerciciosJava/miBanco/src/test/java/com/mibanco/utilTest/A
uditoriaUtilTest.java: /Users/german/ejercicios
Java/miBanco/src/test/java/com/mibanco/utilTest/AuditoriaUtilTest.java uses unch
ecked or unsafe operations.                    [INFO] /Users/german/ejerciciosJa
va/miBanco/src/test/java/com/mibanco/utilTest/AuditoriaUtilTest.java: Recompile
with -Xlint:un
checked for details.
                                               [INFO] 
[INFO] --- surefire:3.0.0:test (default-test) @ miBanco ---
[INFO] Using auto detected provider org.apache.maven.surefire.junitplatform.JUni
tPlatformProvider
[INFO] 
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest
[INFO] Running com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$Ca
rgarDatosCondicionalmenteTests
=== DEBUG: Contenido del archivo JSON ===
Archivo existe: true
Tama√±o del archivo: 430 bytes
Contenido del JSON:
[ {
  "id" : 1,
  "nombre" : "Juan",
  "apellido" : "P√©rez",
  "dni" : "12345678",
  "fechaNacimiento" : "1990-01-01",
  "email" : "juan@test.com",
  "telefono" : "123456789",
  "direccion" : "Calle Test 123"
}, {
  "id" : 5,
  "nombre" : "Mar√≠a",
  "apellido" : "Garc√≠a",
  "dni" : "87654321",
  "fechaNacimiento" : "1985-05-15",
  "email" : "maria@test.com",
  "telefono" : "987654321",
  "direccion" : "Avenida Test 456"
} ]
=========================================
=== DEBUG: Resultado de carga ===
Clientes cargados: 0
Lista cargada: []
=================================
[ERROR] Tests run: 4, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.173 s
<<< FAILURE! - in com.mibanco.repositorioTest.i
nternaTest.BaseProcesadorJsonTest$CargarDatosCondicionalmenteTests
                                               [ERROR] com.mibanco.repositorioTe
st.internaTest.BaseProcesadorJsonTest$CargarDatosCondicionalmenteTests.deberiaCa
rgarDatosDesde
ArchivoExistente(Path)  Time elapsed: 0.155 s  <<< FAILURE!
                                               org.opentest4j.AssertionFailedErr
or: expected: <2> but was: <0>
        at org.junit.jupiter.api.AssertionFailureBuilder.build(AssertionFailureB
uilder.java:151)
        at org.junit.jupiter.api.AssertionFailureBuilder.buildAndThrow(Assertion
FailureBuilder.java:132)
        at org.junit.jupiter.api.AssertEquals.failNotEqual(AssertEquals.java:197
)
        at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:150
)
        at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:145
)
        at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:528)
        at com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$Cargar
DatosCondicionalmenteTests.deberiaCargarDatosDe
sdeArchivoExistente(BaseProcesadorJsonTest.java:204)
                                                       at java.base/jdk.internal
.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
        at java.base/java.lang.reflect.Method.invoke(Method.java:580)
        at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(Reflecti
onUtils.java:727)
        at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInv
ocation.java:60)
        at org.junit.jupiter.engine.execution.InvocationInterceptorChain$Validat
ingInvocation.proceed(InvocationInterceptorChai
n.java:131)
                                                       at org.junit.jupiter.engi
ne.extension.TimeoutExtension.intercept(TimeoutExtension.java:156)
        at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestable
Method(TimeoutExtension.java:147)
        at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMeth
od(TimeoutExtension.java:86)
        at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$Refl
ectiveInterceptorCall.lambda$ofVoidMethod$0(Int
erceptingExecutableInvoker.java:103)
                                                       at org.junit.jupiter.engi
ne.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutabl
eInvoker.java:
93)
                                                       at org.junit.jupiter.engi
ne.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(Invocation
InterceptorCha
in.java:106)
                                                       at org.junit.jupiter.engi
ne.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:
64)
        at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAn
dInvoke(InvocationInterceptorChain.java:45)
        at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(
InvocationInterceptorChain.java:37)
        at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invo
ke(InterceptingExecutableInvoker.java:92)
        at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invo
ke(InterceptingExecutableInvoker.java:86)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$i
nvokeTestMethod$7(TestMethodTestDescriptor.java
:217)
                                                       at org.junit.platform.eng
ine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTe
stMethod(TestMethodTestDescriptor.java:213)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(
TestMethodTestDescriptor.java:138)
        at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(
TestMethodTestDescriptor.java:68)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$ex
ecuteRecursively$6(NodeTestTask.java:151)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.exe
cute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$ex
ecuteRecursively$8(NodeTestTask.java:141)
        at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:
137)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$ex
ecuteRecursively$9(NodeTestTask.java:139)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.exe
cute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRe
cursively(NodeTestTask.java:138)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(N
odeTestTask.java:95)
        at java.base/java.util.ArrayList.forEach(ArrayList.java:1597)
        at org.junit.platform.engine.support.hierarchical.SameThreadHierarchical
TestExecutorService.invokeAll(SameThreadHierarc
hicalTestExecutorService.java:41)
                                                       at org.junit.platform.eng
ine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.j
ava:155)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.exe
cute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$ex
ecuteRecursively$8(NodeTestTask.java:141)
        at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:
137)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$ex
ecuteRecursively$9(NodeTestTask.java:139)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.exe
cute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRe
cursively(NodeTestTask.java:138)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(N
odeTestTask.java:95)
        at java.base/java.util.ArrayList.forEach(ArrayList.java:1597)
        at org.junit.platform.engine.support.hierarchical.SameThreadHierarchical
TestExecutorService.invokeAll(SameThreadHierarc
hicalTestExecutorService.java:41)
                                                       at org.junit.platform.eng
ine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.j
ava:155)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.exe
cute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$ex
ecuteRecursively$8(NodeTestTask.java:141)
        at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:
137)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$ex
ecuteRecursively$9(NodeTestTask.java:139)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.exe
cute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRe
cursively(NodeTestTask.java:138)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(N
odeTestTask.java:95)
        at java.base/java.util.ArrayList.forEach(ArrayList.java:1597)
        at org.junit.platform.engine.support.hierarchical.SameThreadHierarchical
TestExecutorService.invokeAll(SameThreadHierarc
hicalTestExecutorService.java:41)
                                                       at org.junit.platform.eng
ine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.j
ava:155)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.exe
cute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$ex
ecuteRecursively$8(NodeTestTask.java:141)
        at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:
137)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$ex
ecuteRecursively$9(NodeTestTask.java:139)
        at org.junit.platform.engine.support.hierarchical.ThrowableCollector.exe
cute(ThrowableCollector.java:73)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRe
cursively(NodeTestTask.java:138)
        at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(N
odeTestTask.java:95)
        at org.junit.platform.engine.support.hierarchical.SameThreadHierarchical
TestExecutorService.submit(SameThreadHierarchic
alTestExecutorService.java:35)
                                                       at org.junit.platform.eng
ine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecut
or.java:57)
        at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine
.execute(HierarchicalTestEngine.java:54)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(
EngineExecutionOrchestrator.java:147)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(
EngineExecutionOrchestrator.java:127)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(
EngineExecutionOrchestrator.java:90)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$e
xecute$0(EngineExecutionOrchestrator.java:55)
        at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInte
rceptedStreams(EngineExecutionOrchestrator.java
:102)
                                                       at org.junit.platform.lau
ncher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:
54)
        at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLaunc
her.java:114)
        at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLaunc
her.java:86)
        at org.junit.platform.launcher.core.DefaultLauncherSession$DelegatingLau
ncher.execute(DefaultLauncherSession.java:86)
        at org.apache.maven.surefire.junitplatform.LazyLauncher.execute(LazyLaun
cher.java:50)
        at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.execute
(JUnitPlatformProvider.java:184)
        at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeA
llTests(JUnitPlatformProvider.java:148)
        at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(
JUnitPlatformProvider.java:122)
        at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(Fork
edBooter.java:385)
        at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.ja
va:162)
        at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:5
07)
        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:
495)

[INFO] Running com.mibanco.repositorioTest.internaTest.BaseProcesadorJsonTest$Gu
ardarJsonTests
Error al guardar JSON: Cannot invoke "java.io.File.mkdirs()" because the return
value of "java.io.File.getParentFile()" is null
[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.026 s -
 in com.mibanco.repositorioTest.internaTest.Bas
eProcesadorJsonTest$GuardarJsonTests
                                               [INFO] Running com.mibanco.reposi
torioTest.internaTest.BaseProcesadorJsonTest$CalcularMaximoIdTests
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.008 s -
 in com.mibanco.repositorioTest.internaTest.Bas
eProcesadorJsonTest$CalcularMaximoIdTests
                                               [INFO] Tests run: 0, Failures: 0,
 Errors: 0, Skipped: 0, Time elapsed: 0.215 s - in com.mibanco.repositorioTest.i
nternaTest.Bas
eProcesadorJsonTest
                                               [INFO] 
[INFO] Results:
[INFO] 
[ERROR] Failures: 
[ERROR]   BaseProcesadorJsonTest$CargarDatosCondicionalmenteTests.deberiaCargarD
atosDesdeArchivoExistente:204 expected: <2> but
 was: <0>
                                               [INFO] 
[ERROR] Tests run: 11, Failures: 1, Errors: 0, Skipped: 0
[INFO] 
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  3.419 s
[INFO] Finished at: 2025-07-11T13:49:08+02:00
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:3.
0.0:test (default-test) on project miBanco: The
re are test failures.
                                               [ERROR] 
[ERROR] Please refer to /Users/german/ejerciciosJava/miBanco/target/surefire-rep
orts for the individual test results.
[ERROR] Please refer to dump files (if any exist) [date].dump, [date]-jvmRun[N].
dump and [date].dumpstream.
[ERROR] -> [Help 1]
[ERROR] 
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e swit
ch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR] 
[ERROR] For more information about the errors and possible solutions, please rea
d the following articles:
[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureExc
eption

```

---

¬°Ah, German! Tenemos un problema interesante. El test est√° fallando porque:

## **üîç An√°lisis del Problema**

### **Lo que vemos en el debug:**
```
=== DEBUG: Contenido del archivo JSON ===
Archivo existe: true
Tama√±o del archivo: 430 bytes
Contenido del JSON: [ { "id" : 1, "nombre" : "Juan", ... } ]
=========================================
=== DEBUG: Resultado de carga ===
Clientes cargados: 0  ‚Üê ¬°AQU√ç EST√Å EL PROBLEMA!
Lista cargada: []
=================================
```

### **¬øQu√© est√° pasando?**
1. ‚úÖ **El archivo se guarda correctamente** (430 bytes, JSON v√°lido)
2. ‚ùå **Pero al cargarlo, devuelve lista vac√≠a** (0 clientes)

### **Posibles causas:**
1. **Problema con el `ObjectMapper`** - No puede deserializar el JSON
2. **Problema con la clase `Cliente`** - Falta constructor por defecto o getters/setters
3. **Problema con el tipo gen√©rico** - El `ObjectMapper` no puede inferir el tipo correcto

## **ÔøΩÔøΩ Vamos a investigar**

Primero, vamos a revisar la clase `Cliente` para ver si tiene lo necesario para la deserializaci√≥n:


---

Read file: src/main/java/com/mibanco/modelo/Cliente.java

---

¬°Ah√≠ est√° el problema, German! 

## **üîç Problema Identificado**

La clase `Cliente` usa **Lombok con `@Value`**, que crea una clase **inmutable** con:
- ‚úÖ **Constructor por defecto** (generado por Lombok)
- ‚úÖ **Getters** (generados por Lombok)
- ‚ùå **NO tiene setters** (porque es inmutable con `@Value`)

### **¬øPor qu√© falla la deserializaci√≥n?**

El `ObjectMapper` de Jackson necesita **setters** para deserializar JSON a objetos Java. Con `@Value`, Lombok genera una clase inmutable que no tiene setters.

## **üéØ Soluciones Posibles**

### **Opci√≥n 1: Cambiar `@Value` por `@Data`**
```java
@Data
@Builder
public class Cliente implements Identificable {
    // Esto generar√≠a getters Y setters
}
```

### **Opci√≥n 2: Configurar ObjectMapper para usar constructores**
```java
// En BaseProcesadorJson
this.mapper = new ObjectMapper()
    .registerModule(new ParameterNamesModule())
    .disable(SerializationFeature.FAIL_ON_EMPTY_BEANS);
```

### **Opci√≥n 3: Usar `@JsonCreator` en la clase Cliente**
```java
@JsonCreator
public static Cliente of(@JsonProperty("id") Long id, 
                        @JsonProperty("nombre") String nombre, ...) {
    return Cliente.builder()...
}
```

**¬øCu√°l prefieres, German?** La opci√≥n 2 es la m√°s limpia porque no modifica el modelo existente.

---

